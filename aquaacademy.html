<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Atlantis Academy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Styles & Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700" rel="stylesheet">
<style>
body {
  font-family: 'Roboto', sans-serif;
  margin: 0;
  color: #e0f7fa;
  display: flex;
  flex-direction: column;
  min-height:100vh;
  overflow: hidden;
  position: relative;
  background: linear-gradient(135deg, #003844 30%, #006064 100%);
}
.water {
  position:absolute;
  top:0;
  left:0;
  width:100%; 
  height:100%; 
  background: rgba(0,150,136,.3);
  animation: wave 6s infinite linear;
  z-index:0;
}
@keyframes wave {
  0% {transform: translateY(0);}
  50% {transform: translateY(10px);}
  100%{transform: translateY(0);}
}
header {
  background: rgba(0,56,68,.9);
  color:#ffcc80;
  padding:20px;
  text-align:center;
  position:relative;
  z-index:1;
}
nav {
  background: rgba(0,77,64,.95);
  color:#e0f7fa;
  padding:15px;
  display:flex;
  justify-content:space-around;
  box-shadow:0 2px 5px rgba(0,0,0,.3);
  z-index:1;
}
nav button {
  background:transparent;
  border:none;
  color:#e0f7fa;
  cursor:pointer;
  font-weight:500;
  transition:background .3s;
}
nav button:hover {
  background:rgba(255,204,128,.2);
}
.container {
  padding:20px;
  flex:1;
  display:none;
  border-radius:8px;
  box-shadow:0 2px 10px rgba(0,0,0,.3);
  background:rgba(255,255,255,.95);
  color:#004d40;
  margin:20px;
  animation:fadeIn .5s;
  z-index:1;
}
.active {
  display:block;
}
input,select {
  padding:10px;
  margin:10px 0;
  border-radius:5px;
  border:1px solid #00796b;
  width:100%;
  box-sizing:border-box;
}
input:focus,select:focus {
  border-color:#ffcc80;
  outline:none;
}
button {
  padding:10px;
  margin:10px 0;
  border-radius:5px;
  border:none;
  background:#00796b;
  color:#fff;
  cursor:pointer;
  transition:background .3s, transform .2s;
  width:100%; 
}
button:hover {
  background:#ff8f00;
  transform:scale(1.03);
}
.error {
  color:#ff5722;
  margin:10px 0;
}
.spinner {
  display:none;
  margin:20px auto;
  text-align:center;
}
.dark-mode {
  background:#001f24;
  color:#e0f7fa;
}
footer {
  text-align:center;
  padding:10px;
  background:#004d40;
  color:#ffcc80;
  position:relative;
  bottom:0;
  width:100%; 
  z-index:1;
}
@keyframes fadeIn {
  from{opacity:0;}
  to{opacity:1;}
}

/* ==========================
    STYLING LEADERBOARD
========================== */
#allLeaderboards {
  max-height: 450px;
  overflow-y: auto;
  padding: 10px;
}
.leaderboard-subject {
  margin-bottom: 30px;
}
.leaderboard-subject h4,
.leaderboard-subject h3 {
  text-align: left;
  font-size: 1.2em;
  color: #ffcc80;
  font-weight: 600;
  border-bottom: 2px solid #ffcc80;
  padding-bottom: 5px;
  margin: 15px 0 5px;
}
.leaderboard-subject table {
  width:100%;
  border-collapse: collapse;
  margin-bottom:15px;
}
.leaderboard-subject table thead {
  background-color:#006064;
  color:#ffcc80;
}
.leaderboard-subject table th,
.leaderboard-subject table td {
  padding:10px 14px;
  border:1px solid #004d40;
  text-align:left;
}
.leaderboard-subject table tr:nth-child(odd) {
  background-color:#e0f2f1;
}
.leaderboard-subject table tr:nth-child(even) {
  background-color:#b2dfdb;
}
</style>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>
<div class="water"></div>
<header><h1>Atlantis Academy</h1></header>

<!-- Login Screen -->
<div id="loginScreen" class="container active">
    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Email (@atlantis.student.com)">
    <input type="password" id="loginPassword" placeholder="Password">
    <div id="loginError" class="error"></div>
    <button id="loginButton">Login</button>
    <div>Don't have an account? <a href="#" id="showRegisterLink">Register here</a></div>
</div>

<!-- Registration Screen -->
<div id="registerScreen" class="container">
    <h2>Register</h2>
    <input type="text" id="name" placeholder="Name">
    <input type="email" id="registerEmail" placeholder="Email (@atlantis.student.com)">
    <select id="educationLevel">
        <option value="">Select Education Level</option>
        <option value="SD">SD</option>
        <option value="SMP">SMP</option>
        <option value="SMA">SMA</option>
    </select>
    <input type="password" id="registerPassword" placeholder="Password">
    <input type="password" id="confirmPassword" placeholder="Confirm Password">
    <div id="registerError" class="error"></div>
    <button id="registerButton">Register</button>
    <div>Already have an account? <a href="#" id="showLoginLink">Back to Login</a></div>
</div>

<!-- Main Dashboard -->
<div id="dashboard" class="container">
    <nav>
        <button data-page="profilePage">Profile</button>
        <button data-page="materialsPage">Materials</button>
        <button data-page="exercisesPage">Exercises</button>
        <button data-page="leaderboardsPage">Leaderboards</button>
        <button id="logoutButton">Quit</button>
        <button id="toggleDarkMode">Toggle Dark Mode</button>
    </nav>
    <div id="profilePage" class="container active">
        <h3>Profile</h3>
        <div id="profileInfo"></div>
        <button id="changePasswordButton">Change Password</button>
    </div>
    <div id="materialsPage" class="container">
        <h3>Materials</h3>
        <ul>
            <li>Physics: <a href="https://url-to-your-physics.pdf" target="_blank">Download</a></li>
            <li>Chemistry: <a href="https://url-to-your-chemistry.pdf" target="_blank">Download</a></li>
            <li>Biology: <a href="https://url-to-your-biology.pdf" target="_blank">Download</a></li>
            <li>Indonesian: <a href="https://url-to-your-indonesian.pdf" target="_blank">Download</a></li>
            <li>English: <a href="https://url-to-your-english.pdf" target="_blank">Download</a></li>
            <li>Math: <a href="https://url-to-your-math.pdf" target="_blank">Download</a></li>
        </ul>
    </div>
    <div id="exercisesPage" class="container">
        <h3>Exercises</h3>
        <div id="subjectSelector">
            <select id="subjectSelect">
                <option value="">Pilih Mata Pelajaran</option>
                <option value="physics">Physics</option>
                <option value="chemistry">Chemistry</option>
                <option value="biology">Biology</option>
                <option value="indonesian">Indonesian</option>
                <option value="english">English</option>
                <option value="math">Math</option>
            </select>
            <button id="startExercise">Mulai</button>
        </div>
        <div id="questionDisplay"></div>
    </div>
    <div id="leaderboardsPage" class="container">
        <h3>Leaderboards</h3>
        <div id="allLeaderboards"></div>
    </div>
</div>

<div class="spinner" id="loadingSpinner">Loading...</div>

<!-- Scripts Logic -->
<script>
const firebaseConfig = {
    apiKey: "AIzaSyDR04p3qXOTTOp9OEwz-m-M46j5x2FKuKM",
    authDomain: "dungeon-223d9.firebaseapp.com",
    databaseURL: "https://dungeon-223d9-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "dungeon-223d9",
    storageBucket: "dungeon-223d9.firebasestorage.app",
    messagingSenderId: "144074668480",
    appId: "1:144074668480:web:a26bbacfa551112b15f025"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

// State
let currentUser = null;
let currentSubject = '';
let currentQuestionIndex = 0;
let userScore = 0;

const questions = {
  SD: {
    physics: [
      {q: "Benda yang dapat menghantarkan listrik disebut?", options: ["Isolator", "Konduktor", "Gas", "Cairan"], answer: "Konduktor"},
      {q: "Gaya gravitasi membuat benda bergerak ke arah?", options: ["Atas", "Bawah", "Kanan", "Kiri"], answer: "Bawah"},
      {q: "Energi dari matahari disebut energi?", options: ["Kinetik", "Panas", "Bunyi", "Listrik"], answer: "Panas"},
      {q: "Alat untuk mengukur suhu disebut?", options: ["Penggaris", "Termometer", "Neraca", "Mikroskop"], answer: "Termometer"},
      {q: "Benda yang dapat berubah bentuk jika ditekan disebut?", options: ["Benda Keras", "Benda Lentur", "Benda Padat", "Benda Cair"], answer: "Benda Lentur"},
      {q: "Saat bola dilempar ke atas, bola bergerak karena?", options: ["Energi Kinetik", "Energi Panas", "Energi Listrik", "Energi Bunyi"], answer: "Energi Kinetik"},
      {q: "Benda dapat bergerak karena dikenai?", options: ["Gaya", "Panas", "Bunyi", "Cahaya"], answer: "Gaya"},
      {q: "Saat lampu menyala, energi listrik berubah menjadi energi?", options: ["Panas dan Cahaya", "Kinetik", "Bunyi", "Kimia"], answer: "Panas dan Cahaya"},
      {q: "Saat sepeda dikayuh, energi yang digunakan adalah?", options: ["Energi Kimia", "Energi Bunyi", "Energi Kinetik", "Energi Listrik"], answer: "Energi Kinetik"},
      {q: "Saat benda dijatuhkan dari ketinggian, energi berubah dari?", options: ["Kinetik ke Potensial", "Potensial ke Kinetik", "Listrik ke Panas", "Kimia ke Bunyi"], answer: "Potensial ke Kinetik"},
      {q: "Benda yang tidak bisa menghantarkan listrik disebut?", options: ["Konduktor", "Isolator", "Logam", "Kabel"], answer: "Isolator"},
      {q: "Energi yang menyebabkan benda bergerak disebut?", options: ["Energi Kinetik", "Energi Panas", "Energi Bunyi", "Energi Potensial"], answer: "Energi Kinetik"},
      {q: "Alat untuk melihat benda kecil disebut?", options: ["Teleskop", "Kaca Pembesar", "Mikroskop", "Lup"], answer: "Mikroskop"},
      {q: "Contoh gaya otot ditunjukkan saat?", options: ["Mengangkat tas", "Menyetrika baju", "Menyanyi", "Menonton TV"], answer: "Mengangkat tas"},
      {q: "Gaya dapat mengubah?", options: ["Warna benda", "Bentuk dan arah gerak", "Jenis benda", "Ukuran molekul"], answer: "Bentuk dan arah gerak"},
      {q: "Energi listrik bisa diubah menjadi?", options: ["Energi panas", "Energi gravitasi", "Energi magnet", "Energi massa"], answer: "Energi panas"},
      {q: "Benda padat memiliki bentuk yang?", options: ["Tetap", "Berubah-ubah", "Mengalir", "Mengembang"], answer: "Tetap"},
      {q: "Benda cair jika dipindahkan ke wadah lain bentuknya akan?", options: ["Tetap", "Mengalir", "Menyesuaikan wadah", "Mengembang"], answer: "Menyesuaikan wadah"},
      {q: "Matahari adalah sumber energi?", options: ["Bunyi", "Kimia", "Panas dan cahaya", "Gerak"], answer: "Panas dan cahaya"},
      {q: "Kipas angin mengubah energi listrik menjadi energi?", options: ["Panas", "Bunyi", "Gerak", "Kimia"], answer: "Gerak"},
      {q: "Pelangi terjadi karena pembiasan?", options: ["Air", "Cahaya", "Udara", "Listrik"], answer: "Cahaya"},
      {q: "Cermin datar memantulkan cahaya secara?", options: ["Acak", "Lurus", "Teratur", "Menyebar"], answer: "Teratur"},
      {q: "Bunyi bisa terdengar jika ada?", options: ["Udara", "Gambar", "Warna", "Cahaya"], answer: "Udara"},
      {q: "Bunyi tidak bisa merambat melalui?", options: ["Air", "Besi", "Hampa udara", "Udara"], answer: "Hampa udara"},
      {q: "Benda yang bisa memantulkan bunyi disebut?", options: ["Konduktor", "Reflektor", "Isolator", "Penyerap"], answer: "Reflektor"},
      {q: "Contoh sumber energi alternatif adalah?", options: ["Matahari", "Minyak bumi", "Batu bara", "Gas alam"], answer: "Matahari"},
      {q: "Panel surya digunakan untuk mengubah energi matahari menjadi?", options: ["Panas", "Gerak", "Listrik", "Kimia"], answer: "Listrik"},
      {q: "Bayangan di cermin datar bersifat?", options: ["Tegak dan sama besar", "Tegak dan terbalik", "Tegak dan lebih kecil", "Tegak dan lebih besar"], answer: "Tegak dan sama besar"},
      {q: "Saat berlari, tubuh menggunakan energi dari?", options: ["Panas", "Makanan", "Cahaya", "Bunyi"], answer: "Makanan"},
      {q: "Benda yang digunakan untuk menimbang massa adalah?", options: ["Penggaris", "Jam", "Timbangan", "Meteran"], answer: "Timbangan"}
    ],
    chemistry: [
      {q: "Air termasuk contoh zat berwujud?", options: ["Padat", "Cair", "Gas", "Api"], answer: "Cair"},
      {q: "Contoh perubahan wujud dari cair ke gas disebut?", options: ["Mengembun", "Menguap", "Menyublim", "Meleleh"], answer: "Menguap"},
      {q: "Bahan yang dapat menghantarkan panas disebut?", options: ["Konduktor", "Isolator", "Plastik", "Karet"], answer: "Konduktor"},
      {q: "Gas yang digunakan tumbuhan untuk fotosintesis?", options: ["Oksigen", "Hidrogen", "Karbondioksida", "Nitrogen"], answer: "Karbondioksida"},
      {q: "Contoh zat asam dalam rumah tangga?", options: ["Gula", "Garam", "Cuka", "Sabun"], answer: "Cuka"},
      {q: "Perubahan wujud dari padat ke cair disebut?", options: ["Membeku", "Menguap", "Meleleh", "Menyublim"], answer: "Meleleh"},
      {q: "Benda yang tidak dapat kembali ke bentuk asal setelah dibakar disebut?", options: ["Perubahan Fisika", "Perubahan Kimia", "Perubahan Bentuk", "Perubahan Ukuran"], answer: "Perubahan Kimia"},
      {q: "Air laut rasanya asin karena mengandung?", options: ["Gula", "Garam", "Cuka", "Asam"], answer: "Garam"},
      {q: "Campuran antara air dan kopi disebut?", options: ["Larutan", "Zat tunggal", "Gas", "Padat"], answer: "Larutan"},
      {q: "Benda yang mudah terbakar disebut?", options: ["Konduktor", "Inflamabel", "Isolator", "Dingin"], answer: "Inflamabel"},
      {q: "Benda padat jika dipanaskan bisa?", options: ["Mengalir", "Mengendap", "Meleleh", "Menguap"], answer: "Meleleh"},
      {q: "Zat yang tidak bisa diuraikan lagi disebut?", options: ["Senya", "Unsur", "Campuran", "Larutan"], answer: "Unsur"},
      {q: "Contoh zat yang larut dalam air?", options: ["Minyak", "Pasir", "Gula", "Batu"], answer: "Gula"},
      {q: "Alat untuk memisahkan campuran dengan saringan disebut?", options: ["Corong pisah", "Penyaring", "Mikroskop", "Kompor"], answer: "Penyaring"},
      {q: "Proses pemisahan garam dari air laut disebut?", options: ["Penyaringan", "Penguapan", "Penyubliman", "Destilasi"], answer: "Penguapan"},
      {q: "Wujud benda yang bentuk dan volumenya tetap adalah?", options: ["Gas", "Padat", "Cair", "Plasma"], answer: "Padat"},
      {q: "Sifat dari gas adalah?", options: ["Bentuk tetap", "Volume tetap", "Mengisi ruang", "Mengalir ke bawah"], answer: "Mengisi ruang"},
      {q: "Contoh perubahan fisika adalah?", options: ["Kertas dibakar", "Air membeku", "Kayu dibakar", "Besi berkarat"], answer: "Air membeku"},
      {q: "Apa yang terjadi saat air dipanaskan?", options: ["Membeku", "Menguap", "Mengendap", "Mengental"], answer: "Menguap"},
      {q: "Air, udara, dan garam termasuk?", options: ["Zat tunggal", "Zat majemuk", "Campuran", "Asam"], answer: "Campuran"},
      {q: "Campuran yang bisa dipisahkan dengan magnet contohnya?", options: ["Pasir dan air", "Besi dan pasir", "Garam dan air", "Gula dan kopi"], answer: "Besi dan pasir"},
      {q: "Campuran homogen disebut juga?", options: ["Campuran kasar", "Larutan", "Suspensi", "Emulsi"], answer: "Larutan"},
      {q: "Contoh pelarut yang sering digunakan adalah?", options: ["Minyak", "Air", "Pasir", "Alkohol"], answer: "Air"},
      {q: "Zat yang tidak larut disebut?", options: ["Larutan", "Zat pelarut", "Endapan", "Campuran"], answer: "Endapan"},
      {q: "Suhu mempengaruhi cepat tidaknya zat?", options: ["Menguap", "Membeku", "Mencair", "Semua benar"], answer: "Semua benar"},
      {q: "Kapur tulis terbuat dari bahan kimia apa?", options: ["Kalsium karbonat", "Sodium klorida", "Hidrogen", "Karbon dioksida"], answer: "Kalsium karbonat"},
      {q: "Zat aditif pada makanan fungsinya untuk?", options: ["Membuat rasa pahit", "Membusukkan", "Membuat awet", "Membuat lengket"], answer: "Membuat awet"},
      {q: "Sabun bersifat?", options: ["Asam", "Netral", "Basa", "Logam"], answer: "Basa"},
      {q: "Cuka bersifat?", options: ["Asam", "Netral", "Basa", "Padat"], answer: "Asam"},
      {q: "Garam dapur termasuk jenis senyawa?", options: ["Ionik", "Kovalen", "Organik", "Gas"], answer: "Ionik"}
    ],
    biology: [
      {q: "Bagian tumbuhan yang berfungsi menyerap air dari tanah adalah?", options: ["Akar", "Batang", "Daun", "Bunga"], answer: "Akar"},
      {q: "Organ pernapasan manusia adalah?", options: ["Jantung", "Hati", "Paru-paru", "Lambung"], answer: "Paru-paru"},
      {q: "Hewan yang berkembang biak dengan bertelur disebut?", options: ["Vivipar", "Ovipar", "Ovovivipar", "Mamalia"], answer: "Ovipar"},
      {q: "Tumbuhan hijau dapat membuat makanan sendiri melalui proses?", options: ["Respirasi", "Fotosintesis", "Transpirasi", "Fermentasi"], answer: "Fotosintesis"},
      {q: "Bagian tubuh manusia yang berfungsi memompa darah adalah?", options: ["Paru-paru", "Lambung", "Jantung", "Ginjal"], answer: "Jantung"},
      {q: "Bagian tumbuhan yang berfungsi untuk fotosintesis adalah?", options: ["Akar", "Batang", "Daun", "Bunga"], answer: "Daun"},
      {q: "Makanan yang mengandung protein tinggi adalah?", options: ["Beras", "Tempe", "Gula", "Mentega"], answer: "Tempe"},
      {q: "Alat pernapasan pada ikan adalah?", options: ["Paru-paru", "Trakea", "Insang", "Kulit"], answer: "Insang"},
      {q: "Manusia termasuk makhluk hidup yang disebut?", options: ["Herbivora", "Omnivora", "Karnivora", "Produsen"], answer: "Omnivora"},
      {q: "Makhluk hidup berkembang biak untuk?", options: ["Mencari makanan", "Menjaga suhu", "Memperbanyak keturunan", "Bernapas"], answer: "Memperbanyak keturunan"},
      {q: "Bagian tumbuhan yang berfungsi membawa air dan zat hara ke daun?", options: ["Akar", "Batang", "Daun", "Bunga"], answer: "Batang"},
      {q: "Alat gerak utama manusia adalah?", options: ["Tangan", "Kepala", "Kaki", "Kulit"], answer: "Kaki"},
      {q: "Hewan yang memakan tumbuhan disebut?", options: ["Karnivora", "Omnivora", "Herbivora", "Kanibal"], answer: "Herbivora"},
      {q: "Organ yang berfungsi menyaring darah adalah?", options: ["Hati", "Jantung", "Paru-paru", "Ginjal"], answer: "Ginjal"},
      {q: "Masa pertumbuhan manusia dari bayi ke dewasa disebut?", options: ["Perkembangan", "Kematangan", "Penuaan", "Pertidaksamaan"], answer: "Perkembangan"},
      {q: "Fungsi utama tulang pada manusia adalah?", options: ["Melindungi organ tubuh", "Mengatur suhu", "Menghasilkan makanan", "Menyerap air"], answer: "Melindungi organ tubuh"},
      {q: "Hewan yang mengalami metamorfosis sempurna adalah?", options: ["Kucing", "Kupu-kupu", "Ayam", "Manusia"], answer: "Kupu-kupu"},
      {q: "Sumber energi utama bagi manusia adalah?", options: ["Air", "Protein", "Karbohidrat", "Lemak"], answer: "Karbohidrat"},
      {q: "Daun berwarna hijau karena mengandung?", options: ["Karoten", "Klorofil", "Hemoglobin", "Albumin"], answer: "Klorofil"},
      {q: "Organ pernapasan pada katak saat dewasa adalah?", options: ["Insang", "Kulit dan paru-paru", "Trakea", "Spirakel"], answer: "Kulit dan paru-paru"},
      {q: "Hewan yang menyusui anaknya disebut?", options: ["Mamalia", "Reptil", "Amfibi", "Aves"], answer: "Mamalia"},
      {q: "Tumbuhan menghasilkan oksigen saat?", options: ["Bernapas", "Berkembang biak", "Fotosintesis", "Bertumbuh"], answer: "Fotosintesis"},
      {q: "Bagian mata yang berfungsi menerima cahaya adalah?", options: ["Iris", "Kornea", "Retina", "Lensa"], answer: "Retina"},
      {q: "Siklus hidup kupu-kupu dimulai dari?", options: ["Pupa", "Imago", "Telur", "Larva"], answer: "Telur"},
      {q: "Organ pencernaan tempat pencernaan awal protein?", options: ["Usus", "Lambung", "Mulut", "Hati"], answer: "Lambung"},
      {q: "Zat makanan yang membantu pertumbuhan tulang?", options: ["Vitamin A", "Zat Besi", "Kalsium", "Protein"], answer: "Kalsium"},
      {q: "Contoh hewan vivipar adalah?", options: ["Ikan", "Kucing", "Ayam", "Katak"], answer: "Kucing"},
      {q: "Fungsi hidung dalam sistem pernapasan adalah?", options: ["Menghisap makanan", "Menyaring udara", "Menyerap cahaya", "Mengalirkan darah"], answer: "Menyaring udara"},
      {q: "Sumber vitamin A yang baik adalah?", options: ["Wortel", "Beras", "Daging", "Garam"], answer: "Wortel"},
      {q: "Makhluk hidup yang tidak dapat bergerak adalah?", options: ["Tumbuhan", "Hewan", "Manusia", "Ikan"], answer: "Tumbuhan"}
    ],
    indonesian: [
      {q: "Apa sinonim dari kata 'indah'?", options: ["Cantik", "Buruk", "Kotor", "Ribut"], answer: "Cantik"},
      {q: "Antonim dari 'besar' adalah?", options: ["Kecil", "Panjang", "Lebar", "Tinggi"], answer: "Kecil"},
      {q: "Kalimat tanya biasanya diakhiri dengan tanda?", options: ["Seru", "Titik", "Koma", "Tanya"], answer: "Tanya"},
      {q: "Kata 'berlari' termasuk jenis kata?", options: ["Benda", "Kerja", "Sifat", "Keterangan"], answer: "Kerja"},
      {q: "Kata 'merah' termasuk jenis kata?", options: ["Kerja", "Benda", "Sifat", "Bilangan"], answer: "Sifat"},
      {q: "Kata 'sepatu' termasuk jenis kata?", options: ["Kerja", "Benda", "Sifat", "Keterangan"], answer: "Benda"},
      {q: "Kalimat ajakan biasanya diawali dengan kata?", options: ["Jangan", "Mari", "Bukan", "Sudah"], answer: "Mari"},
      {q: "Kalimat 'Sinta membaca buku.' termasuk jenis kalimat?", options: ["Perintah", "Tanya", "Berita", "Ajakan"], answer: "Berita"},
      {q: "Tanda baca untuk mengakhiri kalimat perintah adalah?", options: ["Tanda Seru", "Tanda Titik", "Tanda Koma", "Tanda Tanya"], answer: "Tanda Seru"},
      {q: "Puisi terdiri atas baris dan?", options: ["Halaman", "Bab", "Paragraf", "Bait"], answer: "Bait"},
      {q: "Cerita yang berisi dongeng disebut?", options: ["Legenda", "Fabel", "Cerpen", "Novel"], answer: "Fabel"},
      {q: "Kalimat 'Ibu memasak di dapur.' memiliki predikat apa?", options: ["Ibu", "Memasak", "Di", "Dapur"], answer: "Memasak"},
      {q: "Kata depan 'ke' digunakan untuk menyatakan?", options: ["Tujuan", "Waktu", "Jumlah", "Sifat"], answer: "Tujuan"},
      {q: "Kata baku dari 'aktifitas' adalah?", options: ["Aktifitas", "Aktif", "Aktivitas", "Aktivas"], answer: "Aktivitas"},
      {q: "Kalimat 'Jangan membuang sampah sembarangan!' adalah kalimat?", options: ["Ajakan", "Larangan", "Berita", "Perintah"], answer: "Larangan"},
      {q: "Kata yang menunjukkan jumlah disebut?", options: ["Kata Kerja", "Kata Benda", "Kata Sifat", "Kata Bilangan"], answer: "Kata Bilangan"},
      {q: "Cerita yang mengandung unsur khayalan disebut?", options: ["Fabel", "Cerpen", "Dongeng", "Pantun"], answer: "Dongeng"},
      {q: "Kata 'pagi' termasuk jenis kata?", options: ["Keterangan Waktu", "Benda", "Sifat", "Kerja"], answer: "Keterangan Waktu"},
      {q: "Kata 'bermain' termasuk kata?", options: ["Sifat", "Kerja", "Benda", "Bilangan"], answer: "Kerja"},
      {q: "Sinonim dari kata 'pandai' adalah?", options: ["Bodoh", "Rajin", "Pintar", "Malas"], answer: "Pintar"},
      {q: "Kata 'dan', 'atau', 'tetapi' disebut kata?", options: ["Sambung", "Seru", "Tanya", "Perintah"], answer: "Sambung"},
      {q: "Kalimat sapaan yang benar adalah?", options: ["Hai teman.", "hai Teman", "Hai Teman", "Hai, teman."], answer: "Hai, teman."},
      {q: "Cerpen adalah singkatan dari?", options: ["Cerita Pendek", "Cerita Panjang", "Cerita Pengetahuan", "Cerita Penuh"], answer: "Cerita Pendek"},
      {q: "Kata 'menari' adalah kata kerja yang berarti?", options: ["Berjalan", "Bernyanyi", "Bergerak dengan irama", "Berlari"], answer: "Bergerak dengan irama"},
      {q: "Kalimat yang mengandung perintah disebut?", options: ["Kalimat Tanya", "Kalimat Berita", "Kalimat Seru", "Kalimat Perintah"], answer: "Kalimat Perintah"},
      {q: "Teks yang menjelaskan suatu hal disebut?", options: ["Teks Eksposisi", "Teks Puisi", "Teks Narasi", "Teks Fabel"], answer: "Teks Eksposisi"},
      {q: "Kata 'keindahan' berasal dari kata dasar?", options: ["Indah", "Kehidupan", "Bagus", "Senang"], answer: "Indah"},
      {q: "Cerita yang bersifat nyata disebut?", options: ["Mitos", "Fiksi", "Nonfiksi", "Fabel"], answer: "Nonfiksi"},
      {q: "Tanda baca setelah sapaan dalam surat adalah?", options: ["Titik", "Koma", "Tanda Tanya", "Tanda Seru"], answer: "Koma"},
      {q: "Pantun memiliki rima?", options: ["a-b-a-b", "a-a-a-a", "a-b-c-d", "a-b-b-a"], answer: "a-b-a-b"}
    ],
    english: [
      {q: "What is the English word for 'kucing'?", options: ["Dog", "Cat", "Mouse", "Fish"], answer: "Cat"},
      {q: "Which one is a fruit?", options: ["Carrot", "Potato", "Apple", "Onion"], answer: "Apple"},
      {q: "What is the opposite of 'big'?", options: ["Small", "Tall", "Long", "Short"], answer: "Small"},
      {q: "What color is the sky on a clear day?", options: ["Red", "Blue", "Green", "Yellow"], answer: "Blue"},
      {q: "How do you say 'selamat pagi' in English?", options: ["Good night", "Goodbye", "Good morning", "Good afternoon"], answer: "Good morning"},
      {q: "What number comes after ten?", options: ["Nine", "Eleven", "Eight", "Twelve"], answer: "Eleven"},
      {q: "Which one is used to write?", options: ["Pen", "Book", "Eraser", "Bag"], answer: "Pen"},
      {q: "What is the English word for 'air'?", options: ["Water", "Milk", "Juice", "Tea"], answer: "Water"},
      {q: "What do we use to eat soup?", options: ["Fork", "Knife", "Spoon", "Stick"], answer: "Spoon"},
      {q: "Which day comes after Monday?", options: ["Sunday", "Tuesday", "Wednesday", "Friday"], answer: "Tuesday"},
      {q: "Which animal says 'woof'?", options: ["Cat", "Dog", "Cow", "Bird"], answer: "Dog"},
      {q: "What is the English for 'merah'?", options: ["Green", "Red", "Yellow", "Blue"], answer: "Red"},
      {q: "Which one is a part of the body?", options: ["Chair", "Table", "Hand", "Phone"], answer: "Hand"},
      {q: "What do we wear on our feet?", options: ["Hat", "Shirt", "Shoes", "Scarf"], answer: "Shoes"},
      {q: "What is the opposite of 'happy'?", options: ["Sad", "Glad", "Excited", "Funny"], answer: "Sad"},
      {q: "Which one is a vehicle?", options: ["Car", "Pen", "Book", "Chair"], answer: "Car"},
      {q: "How many legs does a spider have?", options: ["Four", "Six", "Eight", "Ten"], answer: "Eight"},
      {q: "What is the English word for 'sekolah'?", options: ["Hospital", "Library", "School", "Market"], answer: "School"},
      {q: "What color is a banana?", options: ["Green", "Red", "Yellow", "Purple"], answer: "Yellow"},
      {q: "What do we use to see?", options: ["Ears", "Eyes", "Hands", "Mouth"], answer: "Eyes"},
      {q: "Which month comes after August?", options: ["July", "October", "September", "November"], answer: "September"},
      {q: "What do we drink when we are thirsty?", options: ["Water", "Rice", "Bread", "Soup"], answer: "Water"},
      {q: "Which animal has a long neck?", options: ["Elephant", "Tiger", "Giraffe", "Lion"], answer: "Giraffe"},
      {q: "Which one is not a color?", options: ["Pink", "Circle", "Blue", "Black"], answer: "Circle"},
      {q: "How do you say 'terima kasih' in English?", options: ["Please", "Sorry", "Hello", "Thank you"], answer: "Thank you"},
      {q: "What is the English word for 'tangan'?", options: ["Hand", "Head", "Leg", "Foot"], answer: "Hand"},
      {q: "What time do you usually sleep?", options: ["Morning", "Afternoon", "Night", "Lunch"], answer: "Night"},
      {q: "What is the opposite of 'hot'?", options: ["Cold", "Warm", "Spicy", "Boiling"], answer: "Cold"},
      {q: "What do you say when you meet someone?", options: ["Goodbye", "Excuse me", "Hello", "Thank you"], answer: "Hello"},
      {q: "Which one is a family member?", options: ["Teacher", "Mother", "Driver", "Friend"], answer: "Mother"}
    ],
    math: [
      {q: "Hasil dari 7 + 5 adalah?", options: ["10", "11", "12", "13"], answer: "12"},
      {q: "Berapakah hasil dari 9 x 3?", options: ["27", "18", "21", "24"], answer: "27"},
      {q: "Angka genap di bawah 10 adalah?", options: ["1", "3", "6", "9"], answer: "6"},
      {q: "Nilai dari 15 - 7 adalah?", options: ["7", "8", "9", "6"], answer: "8"},
      {q: "Jika Ani memiliki 4 apel dan membeli 3 lagi, berapa totalnya?", options: ["6", "7", "8", "9"], answer: "7"},
      {q: "Luas persegi dengan sisi 5 cm adalah?", options: ["20", "25", "30", "15"], answer: "25"},
      {q: "Bilangan kelipatan 5 berikutnya setelah 20 adalah?", options: ["22", "25", "30", "35"], answer: "25"},
      {q: "Setengah dari 20 adalah?", options: ["5", "8", "10", "12"], answer: "10"},
      {q: "Hasil dari 6 x 4 adalah?", options: ["20", "22", "24", "26"], answer: "24"},
      {q: "Berapakah hasil dari 100 ÷ 10?", options: ["5", "10", "15", "20"], answer: "10"},
      {q: "Bentuk jam 3 sore adalah?", options: ["03.00", "15.00", "13.00", "12.00"], answer: "15.00"},
      {q: "Sebuah segitiga memiliki berapa sisi?", options: ["2", "3", "4", "5"], answer: "3"},
      {q: "Urutan bilangan dari kecil ke besar: 7, 2, 9, 4?", options: ["7, 2, 4, 9", "2, 4, 7, 9", "4, 2, 7, 9", "9, 7, 4, 2"], answer: "2, 4, 7, 9"},
      {q: "Hasil dari 50 - 25 adalah?", options: ["20", "25", "30", "35"], answer: "25"},
      {q: "Jika 1 lusin telur = 12 butir, maka 2 lusin berapa?", options: ["20", "22", "24", "26"], answer: "24"},
      {q: "Berapakah hasil dari 8 + 7 - 5?", options: ["10", "9", "8", "11"], answer: "10"},
      {q: "Angka romawi dari 10 adalah?", options: ["X", "V", "L", "C"], answer: "X"},
      {q: "Hasil dari 6 ÷ 2 adalah?", options: ["2", "3", "4", "5"], answer: "3"},
      {q: "Berapakah seperempat dari 20?", options: ["4", "5", "6", "8"], answer: "5"},
      {q: "Jika kamu punya Rp1000 dan membeli permen Rp250, sisa uangmu adalah?", options: ["Rp500", "Rp600", "Rp700", "Rp750"], answer: "Rp750"},
      {q: "Berapa menit dalam satu jam?", options: ["30", "45", "60", "90"], answer: "60"},
      {q: "Satu kilogram sama dengan?", options: ["100 gram", "500 gram", "1000 gram", "1500 gram"], answer: "1000 gram"},
      {q: "Bangun datar yang memiliki 4 sisi sama panjang adalah?", options: ["Segitiga", "Trapesium", "Persegi", "Persegi Panjang"], answer: "Persegi"},
      {q: "Jika 5 kelereng dibagi ke 5 anak, masing-masing dapat?", options: ["0", "1", "2", "5"], answer: "1"},
      {q: "Hasil dari 9 x 9 adalah?", options: ["81", "72", "90", "99"], answer: "81"},
      {q: "Urutan bilangan ganjil: 1, 3, ..., 7, 9?", options: ["2", "4", "5", "6"], answer: "5"},
      {q: "Berapakah hasil dari 100 - 75?", options: ["20", "25", "30", "35"], answer: "25"},
      {q: "Setengah kilogram adalah?", options: ["100 gram", "250 gram", "500 gram", "750 gram"], answer: "500 gram"},
      {q: "Berapakah hasil dari 3 x 7?", options: ["21", "24", "27", "30"], answer: "21"},
      {q: "Berapakah hasil dari 10 + 20 + 30?", options: ["50", "60", "70", "80"], answer: "60"}
    ]
  },
  SMP: {
    physics: [
      {q: "Benda yang dapat menghantarkan listrik disebut?", options: ["Isolator", "Konduktor", "Gas", "Cairan"], answer: "Konduktor"},
      {q: "Gaya gravitasi membuat benda bergerak ke arah?", options: ["Atas", "Bawah", "Kanan", "Kiri"], answer: "Bawah"},
      {q: "Energi dari matahari disebut energi?", options: ["Kinetik", "Panas", "Bunyi", "Listrik"], answer: "Panas"},
      {q: "Alat untuk mengukur suhu disebut?", options: ["Penggaris", "Termometer", "Neraca", "Mikroskop"], answer: "Termometer"},
      {q: "Benda yang dapat berubah bentuk jika ditekan disebut?", options: ["Benda Keras", "Benda Lentur", "Benda Padat", "Benda Cair"], answer: "Benda Lentur"},
      {q: "Besaran yang dapat diukur disebut?", options: ["Besaran Pokok", "Besaran Turunan", "Besaran Vektor", "Besaran Skalar"], answer: "Besaran Pokok"},
      {q: "Contoh besaran pokok adalah?", options: ["Massa", "Volume", "Kecepatan", "Gaya"], answer: "Massa"},
      {q: "Besaran turunan terdiri dari?", options: ["Panjang", "Suhu", "Kecepatan", "Massa"], answer: "Kecepatan"},
      {q: "Satuan SI untuk panjang adalah?", options: ["Gram", "Meter", "Detik", "Kelvin"], answer: "Meter"},
      {q: "Besaran yang memiliki nilai dan arah disebut?", options: ["Besaran Skalar", "Besaran Vektor", "Besaran Pokok", "Besaran Ukuran"], answer: "Besaran Vektor"}
    ]
  },
  SMA: {
    physics: [
      {q: "Contoh soal Fisika SMA?", options: ["A", "B", "C", "D"], answer: "B"}
    ]
  }
};

function showContainer(containerId) {
    document.querySelectorAll('.container').forEach(el => el.classList.remove('active'));
    document.getElementById(containerId).classList.add('active');
}
function showPage(pageId) {
    document.querySelectorAll('#dashboard .container').forEach(el => el.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
}
function showLoading() { document.getElementById('loadingSpinner').style.display = 'block'; }
function hideLoading() { document.getElementById('loadingSpinner').style.display = 'none'; }

// =================== EXERCISES LOGIC ===================
const subjectSelectEl = document.getElementById('subjectSelect');
const startExerciseButton = document.getElementById('startExercise');
const questionDisplay = document.getElementById('questionDisplay');

startExerciseButton.addEventListener('click', async() => {
    currentSubject = subjectSelectEl.value;
    if (!currentSubject) {
        alert('Pilih mata pelajaran dulu!');
        return;
    }
    if (!questions[currentUser.education_level][currentSubject]) {
        alert('Maaf, belum ada soal untuk mata pelajaran ini!');
        return;
    }
    if (confirm(`Kamu siap menjawab soal ${currentSubject}?`)) {
        currentQuestionIndex = 0;
        userScore = 0;
        showNextQuestion();
    }
});

function showNextQuestion() {
    const subjectQuestions = questions[currentUser.education_level][currentSubject];
    if (currentQuestionIndex >= Math.min(10, subjectQuestions.length)) {
        endExercise();
        return;
    }
    const qObj = subjectQuestions[currentQuestionIndex];
    questionDisplay.innerHTML = `
        <p>${currentQuestionIndex + 1}. ${qObj.q}</p>
        ${qObj.options.map(opt =>
            `<button class="optionBtn" data-answer="${qObj.answer}">${opt}</button>`).join('')}
    `;
    document.querySelectorAll('.optionBtn').forEach(button => {
        button.addEventListener('click', e => {
            const correctAnswer = e.target.getAttribute('data-answer');
            const selected = e.target.textContent.trim();
            if (selected === correctAnswer) {
                alert("Correct!");
                userScore += 1;
            } else {
                alert("Wrong Answer.");
            }
            currentQuestionIndex++;
            showNextQuestion();
        });
    });
}

async function endExercise() {
    alert(`Kamu selesai! Skor kamu: ${userScore}/${Math.min(10, questions[currentUser.education_level][currentSubject].length)}`);
    await db.ref(`users/${currentUser.uid}/points/${currentSubject}`)
        .transaction(val => (val || 0) + userScore);
    await db.ref(`users/${currentUser.uid}/total_score`)
        .transaction(val => (val || 0) + userScore);
    alert("Skor kamu berhasil disimpan!");
    db.ref('users/' + currentUser.uid).once('value').then(snapshot => {
        currentUser = snapshot.val();
        currentUser.uid = auth.currentUser.uid;
        loadProfile();
        loadLeaderboards(); // Tambahkan ini agar leaderboard langsung update

    });
    questionDisplay.innerHTML = '';
}

// =================== AUTH LOGIC ===================
document.getElementById('loginButton').addEventListener('click', async() => {
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value.trim();
    if (!email.endsWith('@atlantis.student.com')) {
        document.getElementById('loginError').innerText = "Email must be atlantis.student.com.";
        return;
    }
    showLoading();
    try {
        await auth.signInWithEmailAndPassword(email, password);
    } catch(error) {
        document.getElementById('loginError').innerText = error.message;
    } finally {
        hideLoading();
    }
});
document.getElementById('registerButton').addEventListener('click', async() => {
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('registerEmail').value.trim();
    const educationLevel = document.getElementById('educationLevel').value.trim();
    const password = document.getElementById('registerPassword').value.trim();
    const confirmPassword = document.getElementById('confirmPassword').value.trim();

    if (!name || !email.endsWith('@atlantis.student.com') || !educationLevel || password.length < 6 || password !== confirmPassword) {
        document.getElementById('registerError').innerText = "Check all fields and match passwords.";
        return;
    }

    showLoading();
    try {
        const userCred = await auth.createUserWithEmailAndPassword(email, password);

        // Simpan ke database
        await db.ref('users/' + userCred.user.uid).set({
            name,
            email,
            education_level: educationLevel,
            points: { physics:0, chemistry:0, biology:0, indonesian:0, english:0, math:0 },
            total_score: 0
        });

        alert("Registration successful!");
        showContainer('loginScreen');
    } catch(error) {
        document.getElementById('registerError').innerText = error.message;
    } finally {
        hideLoading();
    }
});

// =================== AUTH STATE CHANGED ===================
auth.onAuthStateChanged(user => {
    if (user) {
        showLoading();
        db.ref('users/' + user.uid).once('value')
            .then(snapshot => {
                if (snapshot.exists()) {
                    currentUser = snapshot.val();
                    currentUser.uid = user.uid;

                    loadProfile();
                    loadLeaderboards();
                    showContainer('dashboard');
                } else {
                    alert("User data not found. Please register again.");
                    auth.signOut();
                }
            })
            .finally(hideLoading);
    } else {
        showContainer('loginScreen');
    }
});
// =================== UTILITY LOADS ===================
function loadProfile() {
    document.getElementById('profileInfo').innerHTML = `
        <p>Name: ${currentUser.name}</p>
        <p>Email: ${currentUser.email}</p>
        <p>Education Level: ${currentUser.education_level}</p>
        <p>Points:
            Physics: ${currentUser.points.physics || 0},
            Chemistry: ${currentUser.points.chemistry || 0},
            Biology: ${currentUser.points.biology || 0},
            Indonesian: ${currentUser.points.indonesian || 0},
            English: ${currentUser.points.english || 0},
            Math: ${currentUser.points.math || 0}
        </p>
        <p>Total Score: ${currentUser.total_score}</p>`;
}
function loadLeaderboards() {
    const leaderboardDiv = document.getElementById('allLeaderboards');
    leaderboardDiv.innerHTML = '';
    db.ref('users').once('value').then(snapshot => {
        const data = snapshot.val();
        const subjects = ["physics","chemistry","biology","indonesian","english","math"];
        
        subjects.forEach(sub => {
            let scores = [];
            for (let uid in data) {
                const user = data[uid];
                const score = user.points && user.points[sub] ? user.points[sub] : 0;
                scores.push({ name: user.name, score });
            }
            scores.sort((a, b) => b.score - a.score);
            
            let tableRows = scores.slice(0, 10).map((user, index) =>
                `<tr><td>${index + 1}</td><td>${user.name}</td><td>${user.score}</td></tr>`).join('');

            leaderboardDiv.innerHTML += `
                <div class="leaderboard-subject">
                    <h4>${sub.toUpperCase()} Leaderboard (Top 10)</h4>
                    <table>
                        <thead><tr><th>Rank</th><th>Name</th><th>Score</th></tr></thead>
                        <tbody>${tableRows}</tbody>
                    </table>
                </div>`;
        });

        // Overall Leaderboard
        let overall = [];
        for (let uid in data) {
            const user = data[uid];
            const score = user.total_score || 0;
            overall.push({ name: user.name, score });
        }
        overall.sort((a, b) => b.score - a.score);

        let overallRows = overall.slice(0, 10).map((user, index) =>
            `<tr><td>${index + 1}</td><td>${user.name}</td><td>${user.score}</td></tr>`).join('');

        leaderboardDiv.innerHTML += `
            <div class="leaderboard-subject">
                <h3>Overall Leaderboard (Top 10)</h3>
                <table>
                    <thead><tr><th>Rank</th><th>Name</th><th>Score</th></tr></thead>
                    <tbody>${overallRows}</tbody>
                </table>
            </div>`;
    });
}

// =================== BUTTONS LOGIC ===================
document.querySelectorAll('nav button[data-page]').forEach(button => {
    button.addEventListener('click', e => {
        showPage(button.getAttribute('data-page'));
    });
});
document.getElementById('changePasswordButton').addEventListener('click', async() => {
    const newPass = prompt("Enter new password:");
    if(newPass) {
        try {
            await auth.currentUser.updatePassword(newPass);
            alert("Password updated!");
        } catch(error) {
            alert(error.message);
        }
    }
});
document.getElementById('logoutButton').addEventListener('click', async() => {
    await auth.signOut();
});
document.getElementById('toggleDarkMode').addEventListener('click', () => {
    document.body.classList.toggle('dark-mode');
});
document.getElementById('showRegisterLink').addEventListener('click', e => {
    e.preventDefault();
    showContainer('registerScreen');
});
document.getElementById('showLoginLink').addEventListener('click', e => {
    e.preventDefault();
    showContainer('loginScreen');
});
</script>
<footer><p>&copy; 2023 Atlantis Academy. All rights reserved.</p></footer>
</body>
</html>
